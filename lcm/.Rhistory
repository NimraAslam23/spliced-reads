color = "Group",
) +
stat_compare_means()
group_column_density_plot <- group_column |>
ggplot(aes(x = n_spliced_reads,
fill = disease)) +
stat_density() +
scale_x_continuous(trans = scales::pseudo_log_trans()) +
labs(
title = "Number of spliced reads in ALS and controls",
x = "Number of spliced reads",
color = "Group",
)
group_column_density_plot + stat_compare_means()
bar <- mean_per_junction |>
semi_join(significant_junctions, by=("junction_name")) |>
mutate(higher_value = ifelse(ALS>control,"ALS","control")) |>
separate(junction_name, sep = '\\|',into = c("gene","junc_cat","n_datasets_junction_found"),convert = TRUE) |>
ggplot(aes(x = junc_cat, fill = higher_value)) +
geom_bar() +
labs(
title = "Number of junctions significantly higher in ALS and controls",
x = "Junction category",
y = "Number of junctions",
color = "Group",
)
bar + stat_compare_means(method = "anova")
spliced_reads_pdtp_select <- spliced_reads_pdtp |>
select(sample_name, n_spliced_reads, junction_name, pTDP.43, MN_death, pTDP_category)
pTDP_vs_STMN2_reads_boxplot <- spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name)) |>
drop_na() |>
ggplot(aes(x = pTDP_category, y = n_spliced_reads)) +
geom_boxplot() +
theme(legend.position = "none") +
labs(
title = "STMN2 expression is higher with less phosphorylated TDP-43",
x = "pTDP-43 accumulation",
y = "Number of STMN2 spliced reads")
pTDP_vs_STMN2_reads_boxplot + stat_compare_means()
spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name)) |>
drop_na() |>
ggplot(aes(x = pTDP_category, y = MN_death)) +
geom_boxplot() +
theme(legend.position = "none") +
labs(
title = "pTDP-43 levels do not affect viability of motor neurons",
x = "pTDP-43 accumulation",
y = "Motor neuron death (%)")
spliced_reads_pdtp_select <- spliced_reads_pdtp |>
select(sample_name, n_spliced_reads, junction_name, pTDP.43, MN_death, pTDP_category)
pTDP_vs_STMN2_reads_boxplot <- spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name)) |>
drop_na() |>
ggplot(aes(x = pTDP_category, y = n_spliced_reads)) +
geom_boxplot() +
theme(legend.position = "none") +
labs(
title = "STMN2 expression is higher with less phosphorylated TDP-43",
x = "pTDP-43 accumulation",
y = "Number of STMN2 spliced reads")
pTDP_vs_STMN2_reads_boxplot + stat_compare_means()
pTDP_vs_MNdeath_boxplot <- spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name)) |>
drop_na() |>
ggplot(aes(x = pTDP_category, y = MN_death)) +
geom_boxplot() +
theme(legend.position = "none") +
labs(
title = "pTDP-43 levels do not affect viability of motor neurons",
x = "pTDP-43 accumulation",
y = "Motor neuron death (%)")
pTDP_vs_MNdeath_boxplot + stat_compare_means()
STMN2_reads_vs_disease_boxplot <- spliced_reads_pdtp_stmn2 |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = disease)) +
geom_boxplot() +
labs(
title = "Annotated STMN2 event has higher expression in the control samples",
y = "Number of spliced reads"
)
STMN2_reads_vs_disease_boxplot + stat_compare_means()
STMN2_reads_vs_pTDPcat_boxplot <- spliced_reads_pdtp_stmn2 |>
drop_na() |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = pTDP_category)) +
geom_boxplot() +
labs(
title = "Higher expression of annotated STMN2 event with low levels of pTDP",
x = "Junction",
y = "Number of spliced reads"
)
STMN2_reads_vs_pTDPcat_boxplot + stat_compare_means()
STMN2_reads_vs_disease_boxplot <- spliced_reads_pdtp_stmn2 |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = disease)) +
geom_boxplot() +
labs(
title = "Annotated STMN2 event has higher expression in the control samples",
y = "Number of spliced reads"
)
STMN2_reads_vs_disease_boxplot + stat_compare_means()
STMN2_reads_vs_disease_boxplot + stat_compare_means(paired=TRUE)
STMN2_reads_vs_MNdeath_scatterplot <- spliced_reads_pdtp_stmn2 |>
drop_na() |>
ggplot(aes(x = MN_death, y = n_spliced_reads, color = junction)) +
geom_point() +
labs(
x = "Motor neuron death (%)",
y = "Number of spliced reads",
color = "Junction"
)
STMN2_reads_vs_MNdeath_scatterplot + stat_compare_means()
STMN2_reads_vs_MNdeath_scatterplot + stat_compare_means(group = junction)
STMN2_reads_vs_MNdeath_scatterplot <- spliced_reads_pdtp_stmn2 |>
drop_na() |>
ggplot(aes(x = MN_death, y = n_spliced_reads, color = junction)) +
geom_point() +
labs(
x = "Motor neuron death (%)",
y = "Number of spliced reads",
color = "Junction"
) +
stat_compare_means(group = junction)
STMN2_reads_vs_MNdeath_scatterplot <- spliced_reads_pdtp_stmn2 |>
drop_na() |>
ggplot(aes(x = MN_death, y = n_spliced_reads, color = junction)) +
geom_point() +
labs(
x = "Motor neuron death (%)",
y = "Number of spliced reads",
color = "Junction"
) +
stat_compare_means(group = spliced_reads_pdtp_stmn2$junction)
STMN2_reads_vs_MNdeath_scatterplot
STMN2_reads_vs_MNdeath_scatterplot <- spliced_reads_pdtp_stmn2 |>
drop_na() |>
ggplot(aes(x = MN_death, y = n_spliced_reads, color = junction)) +
geom_point() +
labs(
x = "Motor neuron death (%)",
y = "Number of spliced reads",
color = "Junction"
) +
stat_compare_means(aes(group = spliced_reads_pdtp_stmn2$junction))
STMN2_reads_vs_MNdeath_scatterplot
psi_boxplot1 <- psi_stmn2 |>
drop_na() |>
ggplot(aes(x = pTDP_category, y = psi, fill = pTDP_category)) +
geom_boxplot() +
theme(legend.position = "none") +
labs(
title = "STMN2 cryptic splicing is higher with low levels of pTDP",
x = "pTDP-43 accumulation",
y = "PSI value"
)
psi_boxplot1 + stat_compare_means()
psi_boxplot2 <- psi_stmn2 |>
drop_na() |>
ggplot(aes(x = MN_death, y = psi, color = pTDP_category)) +
geom_point() +
labs(
x = "Motor neuron death (%)",
y = "PSI value",
color = "pTDP-43 \naccumulation"
)
psi_boxplot2 + stat_compare_means()
psi_boxplot2 + stat_cor()
STMN2_reads_vs_disease_boxplot <- spliced_reads_pdtp_stmn2 |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = disease)) +
geom_boxplot() +
labs(
title = "Annotated STMN2 event has higher expression in the control samples",
y = "Number of spliced reads"
) +
theme(legend.position = "bottom")
STMN2_reads_vs_disease_boxplot + stat_compare_means()
STMN2_reads_vs_pTDPcat_boxplot <- spliced_reads_pdtp_stmn2 |>
drop_na() |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = pTDP_category)) +
geom_boxplot() +
labs(
title = "Higher expression of annotated STMN2 event with low levels of pTDP",
x = "Junction",
y = "Number of spliced reads"
) +
theme(legend.position = "bottom")
STMN2_reads_vs_pTDPcat_boxplot + stat_compare_means()
install.packages("knitr")
install.packages("knitr")
mean_per_junction_sig <- mean_per_junction |>
semi_join(significant_junctions, by=("junction_name")) |>
mutate(higher_value = ifelse(ALS>control, "ALS", "control")) |>
janitor::tabyl(higher_value)
kable(mean_per_junction_sig, caption = "Junctions expressed higher in ALS and control motor neurons"
mean_per_junction_sig <- mean_per_junction |>
kable(mean_per_junction_sig, caption = "Junctions expressed higher in ALS and control motor neurons.")
library(knitr)
mean_per_junction_sig <- mean_per_junction |>
semi_join(significant_junctions, by=("junction_name")) |>
mutate(higher_value = ifelse(ALS>control, "ALS", "control")) |>
janitor::tabyl(higher_value)
kable(mean_per_junction_sig, caption = "Junctions expressed higher in ALS and control motor neurons.")
datasets_junction_found <- mean_per_junction |>
semi_join(significant_junctions, by=("junction_name")) |>
mutate(higher_value = ifelse(ALS>control,"ALS","control")) |> group_by(higher_value) |>
separate(junction_name, sep = '\\|',into = c("gene","junc_cat","n_datasets_junction_found"),convert = TRUE) |>
summarize(mean_n_datasets = mean(n_datasets_junction_found))
View(psi_stmn2)
mean_per_junction |>
semi_join(significant_junctions, by=("junction_name")) |>
mutate(higher_value = ifelse(ALS>control,"ALS","control")) |>
separate(junction_name, sep = '\\|',into = c("gene","junc_cat","n_datasets_junction_found"),convert = TRUE) |>
ggplot(aes(x = junc_cat, fill = higher_value)) +
geom_bar() +
labs(
title = "Number of junctions significantly higher in ALS and controls",
x = "Junction category",
y = "Number of junctions",
color = "Group",
)
mean_per_junction |>
semi_join(significant_junctions, by=("junction_name")) |>
mutate(higher_value = ifelse(ALS>control,"ALS","control")) |>
separate(junction_name, sep = '\\|',into = c("gene","junc_cat","n_datasets_junction_found"),convert = TRUE) |>
ggplot(aes(x = junc_cat, fill = higher_value)) +
geom_bar() +
labs(
title = "Most of the junctions expressed higher in controls are annotated events",
x = "Junction category",
y = "Number of junctions",
color = "Group",
)
library(snapcount)
pTDP_vs_STMN2_reads_boxplot + stat_compare_means()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(tidyr)
library(dplyr)
library(ggpubr)
library(rstatix)
library(knitr)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(tidyr)
library(dplyr)
library(ggpubr)
library(rstatix)
library(knitr)
# Chunk 2: read in data
spliced_reads_orig <- read.csv("spliced_read_from_lcm.csv")
spliced_reads <- spliced_reads_orig
# Chunk 3: unique samples and junctions
n_samp <- spliced_reads |>
distinct(sample_name) |>
nrow()
n_splice <- spliced_reads |>
distinct(junction_name) |> nrow()
# Chunk 4: disease group column
group_column <- spliced_reads |>
select(junction_name, sample_name, n_spliced_reads) |>
complete(junction_name, sample_name,fill=list(n_spliced_reads = 0)) |>
mutate(disease = ifelse(grepl("ALS", sample_name),
"ALS",
"control"))
# Chunk 5: density plot: number of reads vs disease group
group_column |>
ggplot(aes(x = n_spliced_reads,
fill = disease)) +
stat_density() +
scale_x_continuous(trans = scales::pseudo_log_trans()) +
labs(
title = "Number of spliced reads in ALS and controls",
x = "Number of spliced reads",
color = "Group",
)
# Chunk 6: mean spliced reads for each junction separately per disease group
mean_per_junction <- group_column |>
group_by(junction_name,disease) |>
mutate(mean_n_spliced_reads = mean(n_spliced_reads)) |>
ungroup() |>
select(junction_name,disease,mean_n_spliced_reads) |>
unique() |>
pivot_wider(names_from = 'disease',
values_from = 'mean_n_spliced_reads')
# Chunk 7: nesting
group_column_nested <- group_column |>
group_by(junction_name) |>
nest()
# Chunk 8: wilcoxon test
wilcox_tested_nested = group_column_nested |>
mutate(wc_res = map(data,~{broom::tidy(wilcox.test(
.x$n_spliced_reads ~ .x$disease, exact=FALSE))})) |>
unnest(wc_res) |>
arrange(p.value)
significant_junctions <- wilcox_tested_nested |>
filter(p.value < 0.05)
# Chunk 9: fraction of junctions higher in ALS or controls
mean_per_junction_sig <- mean_per_junction |>
semi_join(significant_junctions, by=("junction_name")) |>
mutate(higher_value = ifelse(ALS>control, "ALS", "control")) |>
janitor::tabyl(higher_value)
kable(mean_per_junction_sig, caption = "A greater proportion of junctions are more highly expressed in controls.")
# Chunk 10: density plot - significant spliced reads in ALS and controls
sig_reads_groups <- group_column |>
semi_join(significant_junctions, by=("junction_name"))
ggplot(sig_reads_groups, aes(x = n_spliced_reads, color = disease, fill = disease)) +
geom_density(alpha = 0.5) +
scale_x_continuous(trans = scales::pseudo_log_trans()) +
labs(
title = "Number of significant spliced reads in ALS and controls",
x = "Number of spliced reads",
)
# Chunk 11
mean_per_junction |>
semi_join(significant_junctions, by=("junction_name")) |>
mutate(higher_value = ifelse(ALS>control,"ALS","control")) |>
separate(junction_name, sep = '\\|',into = c("gene","junc_cat","n_datasets_junction_found"),convert = TRUE) |>
ggplot(aes(x = junc_cat, fill = higher_value)) +
geom_bar() +
labs(
title = "Most of the junctions expressed higher in controls are annotated events",
x = "Junction category",
y = "Number of junctions",
fill = "Group",
)
# Chunk 12
datasets_junction_found <- mean_per_junction |>
semi_join(significant_junctions, by=("junction_name")) |>
mutate(higher_value = ifelse(ALS>control,"ALS","control")) |> group_by(higher_value) |>
separate(junction_name, sep = '\\|',into = c("gene","junc_cat","n_datasets_junction_found"),convert = TRUE) |>
summarize(mean_n_datasets = mean(n_datasets_junction_found))
kable(datasets_junction_found)
# Chunk 13
ptdp_orig <- read.csv("ptdp_mn_death.csv")
spliced_reads$sample_name <- gsub(".SJ.out", "", as.character(spliced_reads$sample_name))
ptdp_orig <- ptdp_orig |>
rename("sample_name" = "sample")
spliced_reads_pdtp <- spliced_reads |>
left_join(ptdp_orig, by = "sample_name")
# Chunk 14
spliced_reads_pdtp_select <- spliced_reads_pdtp |>
select(sample_name, n_spliced_reads, junction_name, pTDP.43, MN_death, pTDP_category)
pTDP_vs_STMN2_reads_boxplot <- spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name)) |>
drop_na() |>
ggplot(aes(x = pTDP_category, y = n_spliced_reads)) +
geom_boxplot() +
theme(legend.position = "none") +
labs(
title = "STMN2 expression is higher with less phosphorylated TDP-43",
x = "pTDP-43 accumulation",
y = "Number of STMN2 spliced reads")
pTDP_vs_STMN2_reads_boxplot + stat_compare_means()
pTDP_vs_MNdeath_boxplot <- spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name)) |>
drop_na() |>
ggplot(aes(x = pTDP_category, y = MN_death)) +
geom_boxplot() +
theme(legend.position = "none") +
labs(
title = "pTDP-43 levels do not affect viability of motor neurons",
x = "pTDP-43 accumulation",
y = "Motor neuron death (%)")
pTDP_vs_MNdeath_boxplot + stat_compare_means()
pTDP_vs_STMN2_reads_boxplot + stat_compare_means()
pTDP_vs_MNdeath_boxplot + stat_compare_means()
stmn2_all_junctions_orig <- read_tsv("stmn2_all_junctions.bed",
col_names = c("chrosome", "start", "end", "sample_name",
"n_spliced_reads", "strand"))
stmn2_all_junctions <- unique(stmn2_all_junctions_orig)
stmn2_all_junctions$sample_name <- gsub(".SJ.out", "", as.character(stmn2_all_junctions$sample_name))
spliced_reads_pdtp_stmn2 <- stmn2_all_junctions |>
left_join(ptdp_orig, by=c("sample_name"))
spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name))
stmn2_all_junctions |>
distinct(end)
spliced_reads_pdtp_stmn2 <- spliced_reads_pdtp_stmn2 |>
mutate(junction = ifelse(grepl("79616822", end),
"cryptic",
"annotated")) |>
mutate(disease = ifelse(grepl("ALS", sample_name),
"ALS",
"control")) |>
relocate(disease, .after = sample_name) |>
relocate(junction, .after = disease)
STMN2_reads_vs_disease_boxplot <- spliced_reads_pdtp_stmn2 |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = disease)) +
geom_boxplot() +
labs(
title = "Annotated STMN2 event has higher expression in the control samples",
y = "Number of spliced reads"
) +
theme(legend.position = "bottom")
STMN2_reads_vs_disease_boxplot + stat_compare_means()
STMN2_reads_vs_pTDPcat_boxplot <- spliced_reads_pdtp_stmn2 |>
drop_na() |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = pTDP_category)) +
geom_boxplot() +
labs(
title = "Higher expression of annotated STMN2 event with low levels of pTDP",
x = "Junction",
y = "Number of spliced reads"
) +
theme(legend.position = "bottom")
STMN2_reads_vs_pTDPcat_boxplot + stat_compare_means()
pTDP_vs_STMN2_reads_boxplot + stat_compare_means()
pTDP_vs_MNdeath_boxplot + stat_compare_means()
stmn2_all_junctions_orig <- read_tsv("stmn2_all_junctions.bed",
col_names = c("chrosome", "start", "end", "sample_name",
"n_spliced_reads", "strand"))
stmn2_all_junctions <- unique(stmn2_all_junctions_orig)
stmn2_all_junctions$sample_name <- gsub(".SJ.out", "", as.character(stmn2_all_junctions$sample_name))
spliced_reads_pdtp_stmn2 <- stmn2_all_junctions |>
left_join(ptdp_orig, by=c("sample_name"))
spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name))
stmn2_all_junctions |>
distinct(end)
spliced_reads_pdtp_stmn2 <- spliced_reads_pdtp_stmn2 |>
mutate(junction = ifelse(grepl("79616822", end),
"cryptic",
"annotated")) |>
mutate(disease = ifelse(grepl("ALS", sample_name),
"ALS",
"control")) |>
relocate(disease, .after = sample_name) |>
relocate(junction, .after = disease)
STMN2_reads_vs_disease_boxplot <- spliced_reads_pdtp_stmn2 |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = disease)) +
geom_boxplot() +
labs(
title = "Annotated STMN2 event has higher expression in the control samples",
y = "Number of spliced reads"
) +
theme(legend.position = "bottom")
STMN2_reads_vs_disease_boxplot + stat_compare_means()
STMN2_reads_vs_pTDPcat_boxplot <- spliced_reads_pdtp_stmn2 |>
drop_na() |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = pTDP_category)) +
geom_boxplot() +
labs(
title = "Higher expression of annotated STMN2 event with low levels of pTDP",
x = "Junction",
y = "Number of spliced reads"
) +
theme(legend.position = "bottom")
STMN2_reads_vs_pTDPcat_boxplot + stat_compare_means()
pTDP_vs_STMN2_reads_boxplot <- spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name)) |>
drop_na() |>
ggplot(aes(x = pTDP_category, y = n_spliced_reads)) +
geom_boxplot() +
theme(legend.position = "none") +
labs(
title = "(a) STMN2 expression is higher with less phosphorylated TDP-43",
x = "pTDP-43 accumulation",
y = "Number of STMN2 spliced reads")
pTDP_vs_STMN2_reads_boxplot + stat_compare_means()
pTDP_vs_MNdeath_boxplot <- spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name)) |>
drop_na() |>
ggplot(aes(x = pTDP_category, y = MN_death)) +
geom_boxplot() +
theme(legend.position = "none") +
labs(
title = "(b) pTDP-43 levels do not affect viability of motor neurons",
x = "pTDP-43 accumulation",
y = "Motor neuron death (%)")
pTDP_vs_MNdeath_boxplot + stat_compare_means()
stmn2_all_junctions_orig <- read_tsv("stmn2_all_junctions.bed",
col_names = c("chrosome", "start", "end", "sample_name",
"n_spliced_reads", "strand"))
stmn2_all_junctions <- unique(stmn2_all_junctions_orig)
stmn2_all_junctions$sample_name <- gsub(".SJ.out", "", as.character(stmn2_all_junctions$sample_name))
spliced_reads_pdtp_stmn2 <- stmn2_all_junctions |>
left_join(ptdp_orig, by=c("sample_name"))
spliced_reads_pdtp_select |>
filter(grepl("STMN2", junction_name))
stmn2_all_junctions |>
distinct(end)
spliced_reads_pdtp_stmn2 <- spliced_reads_pdtp_stmn2 |>
mutate(junction = ifelse(grepl("79616822", end),
"cryptic",
"annotated")) |>
mutate(disease = ifelse(grepl("ALS", sample_name),
"ALS",
"control")) |>
relocate(disease, .after = sample_name) |>
relocate(junction, .after = disease)
STMN2_reads_vs_disease_boxplot <- spliced_reads_pdtp_stmn2 |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = disease)) +
geom_boxplot() +
labs(
title = "(a) Annotated STMN2 event has higher expression in the control samples",
y = "Number of spliced reads"
) +
theme(legend.position = "bottom")
STMN2_reads_vs_disease_boxplot + stat_compare_means()
STMN2_reads_vs_pTDPcat_boxplot <- spliced_reads_pdtp_stmn2 |>
drop_na() |>
ggplot(aes(x = junction, y = n_spliced_reads, fill = pTDP_category)) +
geom_boxplot() +
labs(
title = "(b) Higher expression of annotated STMN2 event with low levels of pTDP",
x = "Junction",
y = "Number of spliced reads"
) +
theme(legend.position = "bottom")
STMN2_reads_vs_pTDPcat_boxplot + stat_compare_means()
